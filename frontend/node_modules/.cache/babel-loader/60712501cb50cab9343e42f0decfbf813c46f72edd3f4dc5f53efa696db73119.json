{"ast":null,"code":"import _objectSpread from\"D:/finance-system/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useTheme}from'../contexts/ThemeContext';import api from'../services/api';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Budgets=()=>{const{colors}=useTheme();const[currentBudget,setCurrentBudget]=useState(null);const[categories,setCategories]=useState([]);const[budgetSummary,setBudgetSummary]=useState(null);const[loading,setLoading]=useState(false);const[showCreateForm,setShowCreateForm]=useState(false);const[showCategoryForm,setShowCategoryForm]=useState(false);const[formData,setFormData]=useState({presupuesto_total:''});const[categoryFormData,setCategoryFormData]=useState({categoria:'',limite_asignado:'',alerta_porcentaje:80});useEffect(()=>{fetchCurrentBudget();fetchCategories();},[]);const fetchCurrentBudget=async()=>{setLoading(true);try{const response=await api.get('/budgets/monthly/current_month/');setCurrentBudget(response.data);fetchBudgetSummary();}catch(error){var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===404){setCurrentBudget(null);}else{toast.error('Error al cargar presupuesto');}}finally{setLoading(false);}};const fetchBudgetSummary=async()=>{try{const response=await api.get('/budgets/monthly/summary/');setBudgetSummary(response.data);}catch(error){var _error$response2;// Silenciar error si no hay resumen disponible\nif(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)!==404){toast.error('Error al cargar resumen de presupuesto');}}};const fetchCategories=async()=>{try{const response=await api.get('/categories/');setCategories(response.data.results||response.data);}catch(error){toast.error('Error al cargar categorÃ­as');}};const handleCreateBudget=async e=>{e.preventDefault();try{await api.post('/budgets/monthly/create_current_month/',formData);toast.success('Presupuesto mensual creado exitosamente');setShowCreateForm(false);setFormData({presupuesto_total:''});fetchCurrentBudget();}catch(error){var _error$response3,_error$response3$data;const errorMessage=((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Error al crear presupuesto';toast.error(errorMessage);}};const handleAddCategoryBudget=async e=>{e.preventDefault();if(!currentBudget)return;try{await api.post(\"/budgets/monthly/\".concat(currentBudget.id,\"/add_category_budget/\"),categoryFormData);toast.success('Presupuesto de categorÃ­a agregado exitosamente');setShowCategoryForm(false);setCategoryFormData({categoria:'',limite_asignado:'',alerta_porcentaje:80});fetchCurrentBudget();}catch(error){var _error$response4,_error$response4$data;const errorMessage=((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.error)||'Error al agregar presupuesto de categorÃ­a';toast.error(errorMessage);}};const formatCurrency=amount=>{return new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN'}).format(amount);};const getStatusColor=estado=>{switch(estado){case'saludable':return'#28a745';case'moderado':return'#ffc107';case'alerta':return'#fd7e14';case'excedido':return'#dc3545';default:return'#6c757d';}};const getStatusIcon=estado=>{switch(estado){case'saludable':return'âœ…';case'moderado':return'âš ï¸';case'alerta':return'ðŸš¨';case'excedido':return'âŒ';default:return'ðŸ“Š';}};const getCurrentMonth=()=>{const now=new Date();const months=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];return\"\".concat(months[now.getMonth()],\" \").concat(now.getFullYear());};if(loading){return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'200px',flexDirection:'column',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'40px',height:'40px',border:\"3px solid \".concat(colors.border),borderTop:\"3px solid \".concat(colors.primary),borderRadius:'50%',animation:'spin 1s linear infinite'}}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary},children:\"Cargando presupuestos...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container animate-fade-in\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'2.5rem',fontWeight:'700',color:colors.textPrimary,marginBottom:'0.5rem'},children:\"\\uD83D\\uDCB0 Presupuestos Mensuales\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,fontSize:'1.125rem',margin:0},children:\"Controla tus gastos y mantente dentro de tus l\\xEDmites\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem'},children:[currentBudget&&/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-success\",onClick:()=>setShowCategoryForm(!showCategoryForm),children:[/*#__PURE__*/_jsx(\"span\",{children:showCategoryForm?'âœ•':'ðŸ·ï¸'}),showCategoryForm?'Cancelar':'Agregar CategorÃ­a']}),!currentBudget&&/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-primary\",onClick:()=>setShowCreateForm(!showCreateForm),children:[/*#__PURE__*/_jsx(\"span\",{children:showCreateForm?'âœ•':'ðŸ’°'}),showCreateForm?'Cancelar':'Crear Presupuesto']})]})]}),showCreateForm&&!currentBudget&&/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card animate-slide-in\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCB0\"}),\"Crear Presupuesto para \",getCurrentMonth()]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCreateBudget,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCB5 Presupuesto Total Mensual\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",className:\"modern-form-control\",value:formData.presupuesto_total,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{presupuesto_total:e.target.value})),placeholder:\"Ej: 15000.00\",required:true}),/*#__PURE__*/_jsx(\"small\",{style:{color:colors.textSecondary,fontSize:'0.875rem'},children:\"Este ser\\xE1 tu l\\xEDmite total de gastos para el mes actual\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"modern-btn modern-btn-primary\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCBE\"}),\"Crear Presupuesto\"]})]})]}),showCategoryForm&&currentBudget&&/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card animate-slide-in\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFF7\\uFE0F\"}),\"Agregar Presupuesto por Categor\\xEDa\"]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAddCategoryBudget,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-grid modern-grid-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83C\\uDFF7\\uFE0F Categor\\xEDa\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"modern-form-control\",value:categoryFormData.categoria,onChange:e=>setCategoryFormData(_objectSpread(_objectSpread({},categoryFormData),{},{categoria:e.target.value})),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccionar categor\\xEDa\"}),categories.filter(cat=>{var _currentBudget$catego;return!((_currentBudget$catego=currentBudget.category_budgets)!==null&&_currentBudget$catego!==void 0&&_currentBudget$catego.some(cb=>cb.categoria===cat.id));}).map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat.id,children:cat.nombre},cat.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCB5 L\\xEDmite Asignado\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",className:\"modern-form-control\",value:categoryFormData.limite_asignado,onChange:e=>setCategoryFormData(_objectSpread(_objectSpread({},categoryFormData),{},{limite_asignado:e.target.value})),placeholder:\"Ej: 3000.00\",required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\u26A0\\uFE0F Porcentaje de Alerta (%)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",max:\"100\",className:\"modern-form-control\",value:categoryFormData.alerta_porcentaje,onChange:e=>setCategoryFormData(_objectSpread(_objectSpread({},categoryFormData),{},{alerta_porcentaje:e.target.value}))}),/*#__PURE__*/_jsx(\"small\",{style:{color:colors.textSecondary,fontSize:'0.875rem'},children:\"Te alertaremos cuando alcances este porcentaje del l\\xEDmite\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem'},children:[/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"modern-btn modern-btn-success\",style:{flex:1},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCBE\"}),\"Agregar Presupuesto\"]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowCategoryForm(false),className:\"modern-btn modern-btn-secondary\",style:{flex:1},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2715\"}),\"Cancelar\"]})]})]})]}),currentBudget?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCCA\"}),\"Resumen de \",getCurrentMonth()]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-grid modern-grid-3\",style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"financial-metric\",style:{'--gradient':colors.primary},children:[/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-icon\",children:\"\\uD83D\\uDCB0\"}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-label\",children:\"Presupuesto Total\"}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-value\",children:formatCurrency(currentBudget.presupuesto_total)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"financial-metric\",style:{'--gradient':colors.expense},children:[/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-icon\",children:\"\\uD83D\\uDCB8\"}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-label\",children:\"Gastado\"}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-value\",children:formatCurrency(currentBudget.gastado_actual)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"financial-metric\",style:{'--gradient':currentBudget.esta_excedido?colors.expense:colors.income},children:[/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-icon\",children:currentBudget.esta_excedido?'âš ï¸':'âœ…'}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-label\",children:currentBudget.esta_excedido?'Excedido':'Disponible'}),/*#__PURE__*/_jsx(\"div\",{className:\"financial-metric-value\",style:{color:currentBudget.esta_excedido?colors.expense:colors.income},children:currentBudget.esta_excedido?formatCurrency(currentBudget.gastado_actual-currentBudget.presupuesto_total):formatCurrency(currentBudget.presupuesto_restante||currentBudget.presupuesto_total-currentBudget.gastado_actual)})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'0.875rem',fontWeight:'500',color:colors.textPrimary},children:\"Progreso del mes\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'0.875rem',color:colors.textSecondary},children:[(currentBudget.porcentaje_gastado||0).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'20px',backgroundColor:colors.border,borderRadius:'10px',overflow:'hidden'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(Math.min(currentBudget.porcentaje_gastado||0,100),\"%\"),height:'100%',background:currentBudget.esta_excedido?colors.expense:(currentBudget.porcentaje_gastado||0)>80?'#fd7e14':colors.income,transition:'width 0.3s ease'}})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'0.875rem',color:colors.textSecondary,flexWrap:'wrap',gap:'0.5rem'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCC5 D\\xEDas restantes: \",currentBudget.dias_restantes_mes||'N/A']}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCA1 Presupuesto diario sugerido: \",formatCurrency(currentBudget.presupuesto_diario_sugerido||0)]})]})]}),currentBudget.category_budgets&&currentBudget.category_budgets.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCCB\"}),\"Presupuestos por Categor\\xEDa\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:\"\".concat(colors.primary,\"15\"),color:colors.primary,padding:'0.5rem 1rem',borderRadius:'2rem',fontSize:'0.875rem',fontWeight:'600'},children:[currentBudget.category_budgets.length,\" categor\\xEDas\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modern-grid modern-grid-2\",children:currentBudget.category_budgets.map(categoryBudget=>{var _categoryBudget$categ;return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1.5rem',background:colors.surfaceHover,borderRadius:'1rem',border:\"1px solid \".concat(colors.border),borderLeft:\"4px solid \".concat(getStatusColor(categoryBudget.estado)),transition:'all 0.2s ease'},onMouseEnter:e=>{e.target.style.transform='translateY(-2px)';e.target.style.boxShadow=colors.shadowLg;},onMouseLeave:e=>{e.target.style.transform='translateY(0)';e.target.style.boxShadow='none';},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'1.25rem'},children:getStatusIcon(categoryBudget.estado)}),/*#__PURE__*/_jsx(\"h4\",{style:{margin:0,fontWeight:'600',color:colors.textPrimary},children:((_categoryBudget$categ=categoryBudget.categoria_info)===null||_categoryBudget$categ===void 0?void 0:_categoryBudget$categ.nombre)||categoryBudget.categoria_nombre||'CategorÃ­a'})]}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'0.75rem',padding:'0.25rem 0.75rem',borderRadius:'1rem',backgroundColor:getStatusColor(categoryBudget.estado),color:'white',fontWeight:'600'},children:(categoryBudget.estado||'normal').toUpperCase()})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'0.875rem',color:colors.textSecondary,marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCB8 Gastado: \",formatCurrency(categoryBudget.gastado_actual||0)]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83C\\uDFAF L\\xEDmite: \",formatCurrency(categoryBudget.limite_asignado||0)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'12px',backgroundColor:colors.border,borderRadius:'6px',overflow:'hidden'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(Math.min(categoryBudget.porcentaje_gastado||0,100),\"%\"),height:'100%',backgroundColor:getStatusColor(categoryBudget.estado),transition:'width 0.3s ease'}})}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',fontSize:'0.75rem',color:colors.textSecondary,marginTop:'0.5rem'},children:[(categoryBudget.porcentaje_gastado||0).toFixed(1),\"% utilizado\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.875rem',color:colors.textSecondary},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'0.25rem'},children:[\"\\uD83D\\uDCB0 Disponible: \",formatCurrency((categoryBudget.limite_asignado||0)-(categoryBudget.gastado_actual||0))]}),categoryBudget.esta_excedido&&/*#__PURE__*/_jsxs(\"div\",{style:{color:colors.expense,fontWeight:'bold',display:'flex',alignItems:'center',gap:'0.25rem'},children:[\"\\u26A0\\uFE0F Excedido por: \",formatCurrency((categoryBudget.gastado_actual||0)-(categoryBudget.limite_asignado||0))]})]})]},categoryBudget.id);})})]}),budgetSummary&&budgetSummary.recomendaciones&&budgetSummary.recomendaciones.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCA1\"}),\"Recomendaciones\"]})}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'column',gap:'0.75rem'},children:budgetSummary.recomendaciones.map((rec,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderRadius:'0.75rem',borderLeft:\"4px solid \".concat(rec.tipo==='warning'?'#ffc107':rec.tipo==='caution'?'#17a2b8':colors.income),background:rec.tipo==='warning'?'#fff3cd':rec.tipo==='caution'?'#d1ecf1':\"\".concat(colors.income,\"15\")},children:[/*#__PURE__*/_jsx(\"h5\",{style:{margin:'0 0 0.5rem 0',fontWeight:'600',color:colors.textPrimary},children:rec.titulo}),/*#__PURE__*/_jsx(\"p\",{style:{margin:0,fontSize:'0.875rem',color:colors.textSecondary},children:rec.mensaje})]},index))})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card text-center\",children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'4rem',marginBottom:'1.5rem',opacity:0.7},children:\"\\uD83D\\uDCB0\"}),/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.5rem',fontWeight:'600',color:colors.textPrimary,marginBottom:'0.5rem'},children:\"No tienes presupuesto para este mes\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,marginBottom:'2rem',fontSize:'1.125rem'},children:\"Crea tu primer presupuesto mensual para empezar a controlar tus gastos\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-primary\",onClick:()=>setShowCreateForm(true),style:{fontSize:'1rem',padding:'1rem 2rem'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCB0\"}),\"Crear Presupuesto\"]})]})]});};export default Budgets;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}