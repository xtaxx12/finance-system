{"ast":null,"code":"import axios from 'axios';\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || 'https://finance-backend-k12z.onrender.com/api',\n  withCredentials: true,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Variable para almacenar el token CSRF\nlet csrfToken = null;\nlet csrfTokenPromise = null;\n\n// Función para obtener el token CSRF del servidor\nconst fetchCSRFToken = async () => {\n  try {\n    const baseURL = api.defaults.baseURL.replace('/api', '');\n    const response = await axios.get(`${baseURL}/api/auth/csrf/`, {\n      withCredentials: true\n    });\n    csrfToken = response.data.csrfToken;\n    return csrfToken;\n  } catch (error) {\n    console.error('Error obteniendo CSRF token:', error);\n    return null;\n  }\n};\n\n// Función para obtener el token CSRF de las cookies\nconst getCSRFTokenFromCookie = () => {\n  const cookies = document.cookie.split(';');\n  for (let cookie of cookies) {\n    const [name, value] = cookie.trim().split('=');\n    if (name === 'csrftoken') {\n      return decodeURIComponent(value);\n    }\n  }\n  return null;\n};\n\n// Función para obtener el token CSRF (primero de cookie, luego del servidor)\nconst getCSRFToken = async () => {\n  // Primero intentar obtener de la cookie\n  let token = getCSRFTokenFromCookie();\n  if (token) {\n    return token;\n  }\n\n  // Si no hay token en cookie y no hay una petición en curso, obtenerlo del servidor\n  if (!csrfTokenPromise) {\n    csrfTokenPromise = fetchCSRFToken().finally(() => {\n      csrfTokenPromise = null;\n    });\n  }\n  token = await csrfTokenPromise;\n  return token || csrfToken;\n};\n\n// Interceptor para agregar el token CSRF a las peticiones\napi.interceptors.request.use(async config => {\n  var _config$method;\n  // Solo agregar CSRF token para métodos que lo requieren\n  if (['post', 'put', 'patch', 'delete'].includes((_config$method = config.method) === null || _config$method === void 0 ? void 0 : _config$method.toLowerCase())) {\n    const token = await getCSRFToken();\n    if (token) {\n      config.headers['X-CSRFToken'] = token;\n    }\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Interceptor para manejar errores de autenticación\napi.interceptors.response.use(response => response, error => {\n  var _error$response;\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n    // Redirigir al login si no está autenticado\n    window.location.href = '/login';\n  }\n  return Promise.reject(error);\n});\nexport default api;","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_URL","withCredentials","headers","csrfToken","csrfTokenPromise","fetchCSRFToken","defaults","replace","response","get","data","error","console","getCSRFTokenFromCookie","cookies","document","cookie","split","name","value","trim","decodeURIComponent","getCSRFToken","token","finally","interceptors","request","use","config","_config$method","includes","method","toLowerCase","Promise","reject","_error$response","status","window","location","href"],"sources":["C:/Users/USER/Downloads/projects/finance-system/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst api = axios.create({\r\n  baseURL: process.env.REACT_APP_API_URL || 'https://finance-backend-k12z.onrender.com/api',\r\n  withCredentials: true,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\n// Variable para almacenar el token CSRF\r\nlet csrfToken = null;\r\nlet csrfTokenPromise = null;\r\n\r\n// Función para obtener el token CSRF del servidor\r\nconst fetchCSRFToken = async () => {\r\n  try {\r\n    const baseURL = api.defaults.baseURL.replace('/api', '');\r\n    const response = await axios.get(`${baseURL}/api/auth/csrf/`, {\r\n      withCredentials: true,\r\n    });\r\n    csrfToken = response.data.csrfToken;\r\n    return csrfToken;\r\n  } catch (error) {\r\n    console.error('Error obteniendo CSRF token:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Función para obtener el token CSRF de las cookies\r\nconst getCSRFTokenFromCookie = () => {\r\n  const cookies = document.cookie.split(';');\r\n  for (let cookie of cookies) {\r\n    const [name, value] = cookie.trim().split('=');\r\n    if (name === 'csrftoken') {\r\n      return decodeURIComponent(value);\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\n// Función para obtener el token CSRF (primero de cookie, luego del servidor)\r\nconst getCSRFToken = async () => {\r\n  // Primero intentar obtener de la cookie\r\n  let token = getCSRFTokenFromCookie();\r\n  if (token) {\r\n    return token;\r\n  }\r\n\r\n  // Si no hay token en cookie y no hay una petición en curso, obtenerlo del servidor\r\n  if (!csrfTokenPromise) {\r\n    csrfTokenPromise = fetchCSRFToken().finally(() => {\r\n      csrfTokenPromise = null;\r\n    });\r\n  }\r\n\r\n  token = await csrfTokenPromise;\r\n  return token || csrfToken;\r\n};\r\n\r\n// Interceptor para agregar el token CSRF a las peticiones\r\napi.interceptors.request.use(\r\n  async (config) => {\r\n    // Solo agregar CSRF token para métodos que lo requieren\r\n    if (['post', 'put', 'patch', 'delete'].includes(config.method?.toLowerCase())) {\r\n      const token = await getCSRFToken();\r\n      if (token) {\r\n        config.headers['X-CSRFToken'] = token;\r\n      }\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// Interceptor para manejar errores de autenticación\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      // Redirigir al login si no está autenticado\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}