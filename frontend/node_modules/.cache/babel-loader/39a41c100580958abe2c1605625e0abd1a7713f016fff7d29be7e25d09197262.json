{"ast":null,"code":"import _objectSpread from\"D:/finance-system/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useTheme}from'../contexts/ThemeContext';import api from'../services/api';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Goals=()=>{const{colors,isDarkMode}=useTheme();const[goals,setGoals]=useState([]);const[loading,setLoading]=useState(false);const[showForm,setShowForm]=useState(false);const[showAddSavings,setShowAddSavings]=useState(null);const[formData,setFormData]=useState({nombre:'',descripcion:'',monto_objetivo:'',monto_actual:'0',fecha_limite:''});const[savingsAmount,setSavingsAmount]=useState('');useEffect(()=>{fetchGoals();},[]);const fetchGoals=async()=>{setLoading(true);try{const response=await api.get('/goals/');setGoals(response.data.results||response.data);}catch(error){toast.error('Error al cargar metas');}finally{setLoading(false);}};const handleSubmit=async e=>{e.preventDefault();try{await api.post('/goals/',formData);toast.success('Meta creada exitosamente');setShowForm(false);setFormData({nombre:'',descripcion:'',monto_objetivo:'',monto_actual:'0',fecha_limite:''});fetchGoals();}catch(error){toast.error('Error al crear meta');}};const handleAddSavings=async goalId=>{try{const response=await api.post(\"/goals/\".concat(goalId,\"/add_savings/\"),{amount:savingsAmount});// Mostrar mensaje personalizado si estÃ¡ disponible\nconst message=response.data.message||'Ahorro agregado exitosamente';toast.success(message);setSavingsAmount('');setShowAddSavings(null);fetchGoals();}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error al agregar ahorro';toast.error(errorMessage);}};const handleMarkCompleted=async goalId=>{try{await api.post(\"/goals/\".concat(goalId,\"/mark_completed/\"));toast.success('Meta marcada como completada');fetchGoals();}catch(error){toast.error('Error al marcar meta como completada');}};const handleDelete=async id=>{if(window.confirm('Â¿EstÃ¡s seguro de eliminar esta meta?')){try{await api.delete(\"/goals/\".concat(id,\"/\"));toast.success('Meta eliminada');fetchGoals();}catch(error){toast.error('Error al eliminar meta');}}};const formatCurrency=amount=>{return new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN'}).format(amount);};const formatDate=dateString=>{if(!dateString)return'Sin fecha lÃ­mite';return new Date(dateString).toLocaleDateString('es-MX');};const getProgressColor=percentage=>{if(percentage>=100)return'#28a745';if(percentage>=75)return'#17a2b8';if(percentage>=50)return'#ffc107';return'#dc3545';};return/*#__PURE__*/_jsxs(\"div\",{className:\"container animate-fade-in\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'2.5rem',fontWeight:'700',color:colors.textPrimary,marginBottom:'0.5rem'},children:\"\\uD83C\\uDFAF Metas de Ahorro\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,fontSize:'1.125rem',margin:0},children:\"Planifica y alcanza tus objetivos financieros\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-primary\",onClick:()=>setShowForm(!showForm),children:[/*#__PURE__*/_jsx(\"span\",{children:showForm?'âœ•':'ðŸŽ¯'}),showForm?'Cancelar':'Nueva Meta']})]}),showForm&&/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card animate-slide-in\",style:{marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),\"Crear Nueva Meta\"]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83C\\uDFF7\\uFE0F Nombre de la Meta\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"modern-form-control\",value:formData.nombre,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{nombre:e.target.value})),placeholder:\"Ej: Vacaciones en la playa\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCDD Descripci\\xF3n\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"modern-form-control\",value:formData.descripcion,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{descripcion:e.target.value})),placeholder:\"Describe tu meta de ahorro\",rows:\"3\",style:{resize:'vertical',minHeight:'80px'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-grid modern-grid-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCB0 Monto Objetivo\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",className:\"modern-form-control\",value:formData.monto_objetivo,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{monto_objetivo:e.target.value})),placeholder:\"0.00\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCB5 Monto Inicial (opcional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",className:\"modern-form-control\",value:formData.monto_actual,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{monto_actual:e.target.value})),placeholder:\"0.00\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCC5 Fecha L\\xEDmite (opcional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"modern-form-control\",value:formData.fecha_limite,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{fecha_limite:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"modern-btn modern-btn-success\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),\"Crear Meta\"]})]})]}),loading?/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'300px',flexDirection:'column',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'60px',height:'60px',border:\"4px solid \".concat(colors.border),borderTop:\"4px solid \".concat(colors.primary),borderRadius:'50%',animation:'spin 1s linear infinite'}}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,fontSize:'1.125rem'},children:\"Cargando metas...\"})]}):goals.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card text-center\",children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'4rem',marginBottom:'1.5rem',opacity:0.5},children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"h3\",{style:{color:colors.textPrimary,marginBottom:'1rem'},children:\"No tienes metas de ahorro\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,marginBottom:'2rem'},children:\"Crea tu primera meta para empezar a ahorrar de manera organizada\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-primary\",onClick:()=>setShowForm(true),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),\"Crear Primera Meta\"]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"modern-grid modern-grid-2\",children:goals.map(goal=>/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card animate-fade-in\",style:{position:'relative'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 0.5rem 0',color:colors.textPrimary,fontSize:'1.5rem',fontWeight:'700'},children:goal.nombre}),goal.completada&&/*#__PURE__*/_jsx(\"span\",{style:{background:colors.gradientIncome,color:'white',padding:'0.25rem 0.75rem',borderRadius:'2rem',fontSize:'0.75rem',fontWeight:'600',display:'inline-flex',alignItems:'center',gap:'0.25rem'},children:\"\\u2713 Completada\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"modern-btn modern-btn-danger\",style:{padding:'0.5rem',minWidth:'auto',fontSize:'0.875rem'},onClick:()=>handleDelete(goal.id),title:\"Eliminar meta\",children:\"\\uD83D\\uDDD1\\uFE0F\"})]}),goal.descripcion&&/*#__PURE__*/_jsx(\"p\",{style:{color:colors.textSecondary,marginBottom:'1.5rem',lineHeight:'1.5'},children:goal.descripcion}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.75rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1.25rem',fontWeight:'700',color:colors.income},children:formatCurrency(goal.monto_actual)}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'1rem',color:colors.textSecondary},children:[\"de \",formatCurrency(goal.monto_objetivo)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'12px',backgroundColor:colors.border,borderRadius:'6px',overflow:'hidden',position:'relative'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(Math.min(goal.porcentaje_completado,100),\"%\"),height:'100%',background:getProgressColor(goal.porcentaje_completado)==='#28a745'?colors.gradientIncome:getProgressColor(goal.porcentaje_completado)==='#17a2b8'?'linear-gradient(135deg, #17a2b8 0%, #138496 100%)':getProgressColor(goal.porcentaje_completado)==='#ffc107'?'linear-gradient(135deg, #ffc107 0%, #e0a800 100%)':'linear-gradient(135deg, #dc3545 0%, #c82333 100%)',transition:'width 0.5s ease',borderRadius:'6px'}})}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginTop:'0.5rem',fontSize:'1rem',fontWeight:'600',color:colors.textPrimary},children:[goal.porcentaje_completado.toFixed(1),\"% completado\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'1rem',marginBottom:'1.5rem',padding:'1rem',background:colors.surfaceHover,borderRadius:'0.75rem',border:\"1px solid \".concat(colors.border)},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:colors.textSecondary,marginBottom:'0.25rem',textTransform:'uppercase',letterSpacing:'0.05em'},children:\"Falta\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1rem',fontWeight:'600',color:colors.textPrimary},children:formatCurrency(goal.monto_faltante)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:colors.textSecondary,marginBottom:'0.25rem',textTransform:'uppercase',letterSpacing:'0.05em'},children:\"Fecha l\\xEDmite\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1rem',fontWeight:'600',color:colors.textPrimary},children:formatDate(goal.fecha_limite)})]}),goal.dias_restantes!==null&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:colors.textSecondary,marginBottom:'0.25rem',textTransform:'uppercase',letterSpacing:'0.05em'},children:\"D\\xEDas restantes\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1rem',fontWeight:'600',color:goal.dias_restantes<=30?colors.expense:colors.textPrimary},children:goal.dias_restantes})]}),goal.ahorro_mensual_sugerido&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:colors.textSecondary,marginBottom:'0.25rem',textTransform:'uppercase',letterSpacing:'0.05em'},children:\"Ahorro sugerido/mes\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1rem',fontWeight:'600',color:colors.primary},children:formatCurrency(goal.ahorro_mensual_sugerido)})]})]}),!goal.completada&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem',marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-success\",style:{flex:1},onClick:()=>setShowAddSavings(showAddSavings===goal.id?null:goal.id),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCB0\"}),showAddSavings===goal.id?'Cancelar':'Agregar Ahorro']}),goal.porcentaje_completado>=100&&/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-primary\",onClick:()=>handleMarkCompleted(goal.id),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2705\"}),\"Completar\"]})]}),showAddSavings===goal.id&&/*#__PURE__*/_jsxs(\"div\",{className:\"animate-slide-in\",style:{padding:'1.5rem',background:colors.surfaceHover,borderRadius:'0.75rem',border:\"1px solid \".concat(colors.border)},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.875rem',color:colors.textSecondary,marginBottom:'1rem',padding:'0.75rem',background:colors.primary+'10',borderRadius:'0.5rem',border:\"1px solid \".concat(colors.primary,\"20\")},children:[\"\\uD83D\\uDCA1 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Nota:\"}),\" Este monto se registrar\\xE1 autom\\xE1ticamente como un gasto de \\\"Ahorro\\\" para reflejar correctamente en tu balance financiero.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"modern-form-label\",children:\"\\uD83D\\uDCB5 Monto a agregar\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",className:\"modern-form-control\",value:savingsAmount,onChange:e=>setSavingsAmount(e.target.value),placeholder:\"0.00\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem'},children:[/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-success\",style:{flex:1},onClick:()=>handleAddSavings(goal.id),disabled:!savingsAmount||parseFloat(savingsAmount)<=0,children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCBE\"}),\"Confirmar Ahorro\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"modern-btn modern-btn-secondary\",onClick:()=>{setShowAddSavings(null);setSavingsAmount('');},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2715\"}),\"Cancelar\"]})]})]})]},goal.id))})]});};export default Goals;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}