{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{useAuth}from'./AuthContext';import{loansApi}from'../services/loansApi';import{jsx as _jsx}from\"react/jsx-runtime\";const BalanceContext=/*#__PURE__*/createContext();export const useBalance=()=>{const context=useContext(BalanceContext);if(!context){throw new Error('useBalance must be used within a BalanceProvider');}return context;};export const BalanceProvider=_ref=>{let{children}=_ref;const{user}=useAuth();const[balance,setBalance]=useState(0);const[totalDebt,setTotalDebt]=useState(0);const[availableBalance,setAvailableBalance]=useState(0);// Calcular el balance total considerando préstamos\nconst calculateBalance=async()=>{if(!user)return;try{// Obtener transacciones del localStorage (por ahora)\nconst transactions=JSON.parse(localStorage.getItem(\"transactions_\".concat(user.id))||'[]');// Calcular balance de transacciones\nconst transactionBalance=transactions.reduce((total,transaction)=>{return transaction.type==='income'?total+transaction.amount:total-transaction.amount;},0);// Obtener resumen de préstamos de la API\nconst loansResponse=await loansApi.getLoansSummary();const debt=loansResponse.data.remaining_debt||0;setBalance(transactionBalance);setTotalDebt(debt);setAvailableBalance(transactionBalance-debt);}catch(error){// Error silenciado, usando fallback\n// Fallback al localStorage si falla la API\nconst transactions=JSON.parse(localStorage.getItem(\"transactions_\".concat(user.id))||'[]');const transactionBalance=transactions.reduce((total,transaction)=>{return transaction.type==='income'?total+transaction.amount:total-transaction.amount;},0);const loans=JSON.parse(localStorage.getItem(\"loans_\".concat(user.id))||'[]');const debt=loans.reduce((total,loan)=>{var _loan$payments;const totalPaid=((_loan$payments=loan.payments)===null||_loan$payments===void 0?void 0:_loan$payments.reduce((sum,payment)=>sum+payment.amount,0))||0;const remaining=loan.amount-totalPaid;return total+Math.max(0,remaining);},0);setBalance(transactionBalance);setTotalDebt(debt);setAvailableBalance(transactionBalance-debt);}};// Recalcular cuando cambie el usuario\nuseEffect(()=>{calculateBalance();},[user]);// Función para actualizar el balance (llamar cuando se agreguen transacciones o pagos)\nconst updateBalance=()=>{calculateBalance();};const value={balance,totalDebt,availableBalance,updateBalance};return/*#__PURE__*/_jsx(BalanceContext.Provider,{value:value,children:children});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}