{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\Downloads\\\\projects\\\\finance-system\\\\frontend\\\\src\\\\contexts\\\\BalanceContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useAuth } from './AuthContext';\nimport { loansApi } from '../services/loansApi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BalanceContext = /*#__PURE__*/createContext();\nexport const useBalance = () => {\n  _s();\n  const context = useContext(BalanceContext);\n  if (!context) {\n    throw new Error('useBalance must be used within a BalanceProvider');\n  }\n  return context;\n};\n_s(useBalance, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const BalanceProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    user\n  } = useAuth();\n  const [balance, setBalance] = useState(0);\n  const [totalDebt, setTotalDebt] = useState(0);\n  const [availableBalance, setAvailableBalance] = useState(0);\n  const [debtProgress, setDebtProgress] = useState(0);\n\n  // Calcular el balance total considerando préstamos\n  const calculateBalance = async () => {\n    if (!user) return;\n    try {\n      // Obtener transacciones del localStorage (por ahora)\n      const transactions = JSON.parse(localStorage.getItem(`transactions_${user.id}`) || '[]');\n\n      // Calcular balance de transacciones\n      const transactionBalance = transactions.reduce((total, transaction) => {\n        return transaction.type === 'income' ? total + transaction.amount : total - transaction.amount;\n      }, 0);\n\n      // Obtener resumen de préstamos de la API\n      const loansResponse = await loansApi.getLoansSummary();\n      const debt = loansResponse.data.remaining_debt || 0;\n      const progress = loansResponse.data.completion_percentage || 0;\n      setBalance(transactionBalance);\n      setTotalDebt(debt);\n      setAvailableBalance(transactionBalance - debt);\n      setDebtProgress(progress);\n    } catch (error) {\n      // Error silenciado, usando fallback\n      // Fallback al localStorage si falla la API\n      const transactions = JSON.parse(localStorage.getItem(`transactions_${user.id}`) || '[]');\n      const transactionBalance = transactions.reduce((total, transaction) => {\n        return transaction.type === 'income' ? total + transaction.amount : total - transaction.amount;\n      }, 0);\n      const loans = JSON.parse(localStorage.getItem(`loans_${user.id}`) || '[]');\n      const debt = loans.reduce((total, loan) => {\n        var _loan$payments;\n        const totalPaid = ((_loan$payments = loan.payments) === null || _loan$payments === void 0 ? void 0 : _loan$payments.reduce((sum, payment) => sum + payment.amount, 0)) || 0;\n        const remaining = loan.amount - totalPaid;\n        return total + Math.max(0, remaining);\n      }, 0);\n      setBalance(transactionBalance);\n      setTotalDebt(debt);\n      setAvailableBalance(transactionBalance - debt);\n\n      // Calcular progreso de deuda manualmente\n      const totalOriginal = loans.reduce((sum, loan) => sum + loan.amount, 0);\n      const totalPaidAmount = loans.reduce((sum, loan) => {\n        var _loan$payments2;\n        const paid = ((_loan$payments2 = loan.payments) === null || _loan$payments2 === void 0 ? void 0 : _loan$payments2.reduce((pSum, payment) => pSum + payment.amount, 0)) || 0;\n        return sum + paid;\n      }, 0);\n      const progress = totalOriginal > 0 ? totalPaidAmount / totalOriginal * 100 : 0;\n      setDebtProgress(progress);\n    }\n  };\n\n  // Recalcular cuando cambie el usuario\n  useEffect(() => {\n    calculateBalance();\n  }, [user]);\n\n  // Función para actualizar el balance (llamar cuando se agreguen transacciones o pagos)\n  const updateBalance = () => {\n    calculateBalance();\n  };\n  const value = {\n    balance,\n    totalDebt,\n    availableBalance,\n    debtProgress,\n    updateBalance\n  };\n  return /*#__PURE__*/_jsxDEV(BalanceContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n};\n_s2(BalanceProvider, \"mCDexnEEM0C8g3CB86YHMAAnFlA=\", false, function () {\n  return [useAuth];\n});\n_c = BalanceProvider;\nvar _c;\n$RefreshReg$(_c, \"BalanceProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useAuth","loansApi","jsxDEV","_jsxDEV","BalanceContext","useBalance","_s","context","Error","BalanceProvider","children","_s2","user","balance","setBalance","totalDebt","setTotalDebt","availableBalance","setAvailableBalance","debtProgress","setDebtProgress","calculateBalance","transactions","JSON","parse","localStorage","getItem","id","transactionBalance","reduce","total","transaction","type","amount","loansResponse","getLoansSummary","debt","data","remaining_debt","progress","completion_percentage","error","loans","loan","_loan$payments","totalPaid","payments","sum","payment","remaining","Math","max","totalOriginal","totalPaidAmount","_loan$payments2","paid","pSum","updateBalance","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/USER/Downloads/projects/finance-system/frontend/src/contexts/BalanceContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport { loansApi } from '../services/loansApi';\r\n\r\nconst BalanceContext = createContext();\r\n\r\nexport const useBalance = () => {\r\n  const context = useContext(BalanceContext);\r\n  if (!context) {\r\n    throw new Error('useBalance must be used within a BalanceProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const BalanceProvider = ({ children }) => {\r\n  const { user } = useAuth();\r\n  const [balance, setBalance] = useState(0);\r\n  const [totalDebt, setTotalDebt] = useState(0);\r\n  const [availableBalance, setAvailableBalance] = useState(0);\r\n  const [debtProgress, setDebtProgress] = useState(0);\r\n\r\n  // Calcular el balance total considerando préstamos\r\n  const calculateBalance = async () => {\r\n    if (!user) return;\r\n\r\n    try {\r\n      // Obtener transacciones del localStorage (por ahora)\r\n      const transactions = JSON.parse(localStorage.getItem(`transactions_${user.id}`) || '[]');\r\n      \r\n      // Calcular balance de transacciones\r\n      const transactionBalance = transactions.reduce((total, transaction) => {\r\n        return transaction.type === 'income' \r\n          ? total + transaction.amount \r\n          : total - transaction.amount;\r\n      }, 0);\r\n\r\n      // Obtener resumen de préstamos de la API\r\n      const loansResponse = await loansApi.getLoansSummary();\r\n      const debt = loansResponse.data.remaining_debt || 0;\r\n      const progress = loansResponse.data.completion_percentage || 0;\r\n\r\n      setBalance(transactionBalance);\r\n      setTotalDebt(debt);\r\n      setAvailableBalance(transactionBalance - debt);\r\n      setDebtProgress(progress);\r\n    } catch (error) {\r\n      \r\n      // Error silenciado, usando fallback\r\n      // Fallback al localStorage si falla la API\r\n      const transactions = JSON.parse(localStorage.getItem(`transactions_${user.id}`) || '[]');\r\n      const transactionBalance = transactions.reduce((total, transaction) => {\r\n        return transaction.type === 'income' \r\n          ? total + transaction.amount \r\n          : total - transaction.amount;\r\n      }, 0);\r\n\r\n      const loans = JSON.parse(localStorage.getItem(`loans_${user.id}`) || '[]');\r\n    \r\n      \r\n      const debt = loans.reduce((total, loan) => {\r\n        const totalPaid = loan.payments?.reduce((sum, payment) => sum + payment.amount, 0) || 0;\r\n        const remaining = loan.amount - totalPaid;\r\n       \r\n        return total + Math.max(0, remaining);\r\n      }, 0);\r\n\r\n      \r\n\r\n      setBalance(transactionBalance);\r\n      setTotalDebt(debt);\r\n      setAvailableBalance(transactionBalance - debt);\r\n      \r\n      // Calcular progreso de deuda manualmente\r\n      const totalOriginal = loans.reduce((sum, loan) => sum + loan.amount, 0);\r\n      const totalPaidAmount = loans.reduce((sum, loan) => {\r\n        const paid = loan.payments?.reduce((pSum, payment) => pSum + payment.amount, 0) || 0;\r\n        return sum + paid;\r\n      }, 0);\r\n      const progress = totalOriginal > 0 ? (totalPaidAmount / totalOriginal) * 100 : 0;\r\n      setDebtProgress(progress);\r\n    }\r\n  };\r\n\r\n  // Recalcular cuando cambie el usuario\r\n  useEffect(() => {\r\n    calculateBalance();\r\n  }, [user]);\r\n\r\n  // Función para actualizar el balance (llamar cuando se agreguen transacciones o pagos)\r\n  const updateBalance = () => {\r\n    calculateBalance();\r\n  };\r\n\r\n  const value = {\r\n    balance,\r\n    totalDebt,\r\n    availableBalance,\r\n    debtProgress,\r\n    updateBalance\r\n  };\r\n\r\n  return (\r\n    <BalanceContext.Provider value={value}>\r\n      {children}\r\n    </BalanceContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}