{"ast":null,"code":"var _excluded = [\"onMouseEnter\", \"onClick\", \"onMouseLeave\", \"shape\", \"activeShape\"],\n  _excluded2 = [\"id\"],\n  _excluded3 = [\"stroke\", \"fill\", \"legendType\", \"hide\", \"isAnimationActive\", \"animationBegin\", \"animationDuration\", \"animationEasing\", \"nameKey\", \"lastShapeType\", \"id\"],\n  _excluded4 = [\"id\"];\nfunction _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\nfunction _objectWithoutProperties(e, t) {\n  if (null == e) return {};\n  var o,\n    r,\n    i = _objectWithoutPropertiesLoose(e, t);\n  if (Object.getOwnPropertySymbols) {\n    var n = Object.getOwnPropertySymbols(e);\n    for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\n  }\n  return i;\n}\nfunction _objectWithoutPropertiesLoose(r, e) {\n  if (null == r) return {};\n  var t = {};\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\n    if (-1 !== e.indexOf(n)) continue;\n    t[n] = r[n];\n  }\n  return t;\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nimport * as React from 'react';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport omit from 'es-toolkit/compat/omit';\nimport { clsx } from 'clsx';\nimport { selectActiveIndex } from '../state/selectors/selectors';\nimport { useAppSelector } from '../state/hooks';\nimport { Layer } from '../container/Layer';\nimport { CartesianLabelListContextProvider, LabelListFromLabelProp } from '../component/LabelList';\nimport { getPercentValue, interpolate } from '../util/DataUtils';\nimport { getValueByDataKey } from '../util/ChartUtils';\nimport { adaptEventsOfChild } from '../util/types';\nimport { FunnelTrapezoid } from '../util/FunnelUtils';\nimport { useMouseClickItemDispatch, useMouseEnterItemDispatch, useMouseLeaveItemDispatch } from '../context/tooltipContext';\nimport { SetTooltipEntrySettings } from '../state/SetTooltipEntrySettings';\nimport { selectFunnelTrapezoids } from '../state/selectors/funnelSelectors';\nimport { findAllByType } from '../util/ReactUtils';\nimport { Cell } from '../component/Cell';\nimport { resolveDefaultProps } from '../util/resolveDefaultProps';\nimport { usePlotArea } from '../hooks';\nimport { svgPropertiesNoEvents } from '../util/svgPropertiesNoEvents';\nimport { JavascriptAnimate } from '../animation/JavascriptAnimate';\nimport { useAnimationId } from '../util/useAnimationId';\nimport { RegisterGraphicalItemId } from '../context/RegisterGraphicalItemId';\n\n/**\n * Internal props, combination of external props + defaultProps + private Recharts state\n */\n\n/**\n * External props, intended for end users to fill in\n */\n\nvar SetFunnelTooltipEntrySettings = /*#__PURE__*/React.memo(_ref => {\n  var {\n    dataKey,\n    nameKey,\n    stroke,\n    strokeWidth,\n    fill,\n    name,\n    hide,\n    tooltipType,\n    data,\n    trapezoids,\n    id\n  } = _ref;\n  var tooltipEntrySettings = {\n    dataDefinedOnItem: data,\n    positions: trapezoids.map(_ref2 => {\n      var {\n        tooltipPosition\n      } = _ref2;\n      return tooltipPosition;\n    }),\n    settings: {\n      stroke,\n      strokeWidth,\n      fill,\n      dataKey,\n      name,\n      nameKey,\n      hide,\n      type: tooltipType,\n      color: fill,\n      unit: '',\n      // Funnel does not have unit, why?\n      graphicalItemId: id\n    }\n  };\n  return /*#__PURE__*/React.createElement(SetTooltipEntrySettings, {\n    tooltipEntrySettings: tooltipEntrySettings\n  });\n});\nfunction FunnelLabelListProvider(_ref3) {\n  var {\n    showLabels,\n    trapezoids,\n    children\n  } = _ref3;\n  var labelListEntries = useMemo(() => {\n    if (!showLabels) {\n      return undefined;\n    }\n    return trapezoids === null || trapezoids === void 0 ? void 0 : trapezoids.map(entry => {\n      var viewBox = entry.labelViewBox;\n      return _objectSpread(_objectSpread({}, viewBox), {}, {\n        value: entry.name,\n        payload: entry.payload,\n        parentViewBox: entry.parentViewBox,\n        viewBox,\n        fill: entry.fill\n      });\n    });\n  }, [showLabels, trapezoids]);\n  return /*#__PURE__*/React.createElement(CartesianLabelListContextProvider, {\n    value: labelListEntries\n  }, children);\n}\nfunction FunnelTrapezoids(props) {\n  var {\n    trapezoids,\n    allOtherFunnelProps\n  } = props;\n  var activeItemIndex = useAppSelector(state => selectActiveIndex(state, 'item', state.tooltip.settings.trigger, undefined));\n  var {\n      onMouseEnter: onMouseEnterFromProps,\n      onClick: onItemClickFromProps,\n      onMouseLeave: onMouseLeaveFromProps,\n      shape,\n      activeShape\n    } = allOtherFunnelProps,\n    restOfAllOtherProps = _objectWithoutProperties(allOtherFunnelProps, _excluded);\n  var onMouseEnterFromContext = useMouseEnterItemDispatch(onMouseEnterFromProps, allOtherFunnelProps.dataKey, allOtherFunnelProps.id);\n  var onMouseLeaveFromContext = useMouseLeaveItemDispatch(onMouseLeaveFromProps);\n  var onClickFromContext = useMouseClickItemDispatch(onItemClickFromProps, allOtherFunnelProps.dataKey, allOtherFunnelProps.id);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, trapezoids.map((entry, i) => {\n    var isActiveIndex = Boolean(activeShape) && activeItemIndex === String(i);\n    var trapezoidOptions = isActiveIndex ? activeShape : shape;\n    var _entry$option$isActiv = _objectSpread(_objectSpread({}, entry), {}, {\n        option: trapezoidOptions,\n        isActive: isActiveIndex,\n        stroke: entry.stroke\n      }),\n      {\n        id\n      } = _entry$option$isActiv,\n      trapezoidProps = _objectWithoutProperties(_entry$option$isActiv, _excluded2);\n    return /*#__PURE__*/React.createElement(Layer, _extends({\n      key: \"trapezoid-\".concat(entry === null || entry === void 0 ? void 0 : entry.x, \"-\").concat(entry === null || entry === void 0 ? void 0 : entry.y, \"-\").concat(entry === null || entry === void 0 ? void 0 : entry.name, \"-\").concat(entry === null || entry === void 0 ? void 0 : entry.value),\n      className: \"recharts-funnel-trapezoid\"\n    }, adaptEventsOfChild(restOfAllOtherProps, entry, i), {\n      // @ts-expect-error the types need a bit of attention\n      onMouseEnter: onMouseEnterFromContext(entry, i)\n      // @ts-expect-error the types need a bit of attention\n      ,\n\n      onMouseLeave: onMouseLeaveFromContext(entry, i)\n      // @ts-expect-error the types need a bit of attention\n      ,\n\n      onClick: onClickFromContext(entry, i)\n    }), /*#__PURE__*/React.createElement(FunnelTrapezoid, trapezoidProps));\n  }));\n}\nfunction TrapezoidsWithAnimation(_ref4) {\n  var {\n    previousTrapezoidsRef,\n    props\n  } = _ref4;\n  var {\n    trapezoids,\n    isAnimationActive,\n    animationBegin,\n    animationDuration,\n    animationEasing,\n    onAnimationEnd,\n    onAnimationStart\n  } = props;\n  var prevTrapezoids = previousTrapezoidsRef.current;\n  var [isAnimating, setIsAnimating] = useState(false);\n  var showLabels = !isAnimating;\n  var animationId = useAnimationId(trapezoids, 'recharts-funnel-');\n  var handleAnimationEnd = useCallback(() => {\n    if (typeof onAnimationEnd === 'function') {\n      onAnimationEnd();\n    }\n    setIsAnimating(false);\n  }, [onAnimationEnd]);\n  var handleAnimationStart = useCallback(() => {\n    if (typeof onAnimationStart === 'function') {\n      onAnimationStart();\n    }\n    setIsAnimating(true);\n  }, [onAnimationStart]);\n  return /*#__PURE__*/React.createElement(FunnelLabelListProvider, {\n    showLabels: showLabels,\n    trapezoids: trapezoids\n  }, /*#__PURE__*/React.createElement(JavascriptAnimate, {\n    animationId: animationId,\n    begin: animationBegin,\n    duration: animationDuration,\n    isActive: isAnimationActive,\n    easing: animationEasing,\n    key: animationId,\n    onAnimationStart: handleAnimationStart,\n    onAnimationEnd: handleAnimationEnd\n  }, t => {\n    var stepData = t === 1 ? trapezoids : trapezoids.map((entry, index) => {\n      var prev = prevTrapezoids && prevTrapezoids[index];\n      if (prev) {\n        return _objectSpread(_objectSpread({}, entry), {}, {\n          x: interpolate(prev.x, entry.x, t),\n          y: interpolate(prev.y, entry.y, t),\n          upperWidth: interpolate(prev.upperWidth, entry.upperWidth, t),\n          lowerWidth: interpolate(prev.lowerWidth, entry.lowerWidth, t),\n          height: interpolate(prev.height, entry.height, t)\n        });\n      }\n      return _objectSpread(_objectSpread({}, entry), {}, {\n        x: interpolate(entry.x + entry.upperWidth / 2, entry.x, t),\n        y: interpolate(entry.y + entry.height / 2, entry.y, t),\n        upperWidth: interpolate(0, entry.upperWidth, t),\n        lowerWidth: interpolate(0, entry.lowerWidth, t),\n        height: interpolate(0, entry.height, t)\n      });\n    });\n    if (t > 0) {\n      // eslint-disable-next-line no-param-reassign\n      previousTrapezoidsRef.current = stepData;\n    }\n    return /*#__PURE__*/React.createElement(Layer, null, /*#__PURE__*/React.createElement(FunnelTrapezoids, {\n      trapezoids: stepData,\n      allOtherFunnelProps: props\n    }));\n  }), /*#__PURE__*/React.createElement(LabelListFromLabelProp, {\n    label: props.label\n  }), props.children);\n}\nfunction RenderTrapezoids(props) {\n  var previousTrapezoidsRef = useRef(undefined);\n  return /*#__PURE__*/React.createElement(TrapezoidsWithAnimation, {\n    props: props,\n    previousTrapezoidsRef: previousTrapezoidsRef\n  });\n}\nvar getRealWidthHeight = (customWidth, offset) => {\n  var {\n    width,\n    height,\n    left,\n    top\n  } = offset;\n  var realWidth = getPercentValue(customWidth, width, width);\n  return {\n    realWidth,\n    realHeight: height,\n    offsetX: left,\n    offsetY: top\n  };\n};\nexport var defaultFunnelProps = {\n  animationBegin: 400,\n  animationDuration: 1500,\n  animationEasing: 'ease',\n  fill: '#808080',\n  hide: false,\n  isAnimationActive: 'auto',\n  lastShapeType: 'triangle',\n  legendType: 'rect',\n  nameKey: 'name',\n  reversed: false,\n  stroke: '#fff'\n};\nfunction FunnelImpl(props) {\n  var plotArea = usePlotArea();\n  var {\n      stroke,\n      fill,\n      legendType,\n      hide,\n      isAnimationActive,\n      animationBegin,\n      animationDuration,\n      animationEasing,\n      nameKey,\n      lastShapeType,\n      id\n    } = props,\n    everythingElse = _objectWithoutProperties(props, _excluded3);\n  var presentationProps = svgPropertiesNoEvents(props);\n  var cells = findAllByType(props.children, Cell);\n  var funnelSettings = useMemo(() => ({\n    dataKey: props.dataKey,\n    nameKey,\n    data: props.data,\n    tooltipType: props.tooltipType,\n    lastShapeType,\n    reversed: props.reversed,\n    customWidth: props.width,\n    cells,\n    presentationProps,\n    id\n  }), [props.dataKey, nameKey, props.data, props.tooltipType, lastShapeType, props.reversed, props.width, cells, presentationProps, id]);\n  var trapezoids = useAppSelector(state => selectFunnelTrapezoids(state, funnelSettings));\n  if (hide || !trapezoids || !trapezoids.length || !plotArea) {\n    return null;\n  }\n  var {\n    height,\n    width\n  } = plotArea;\n  var layerClass = clsx('recharts-trapezoids', props.className);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(SetFunnelTooltipEntrySettings, {\n    dataKey: props.dataKey,\n    nameKey: props.nameKey,\n    stroke: props.stroke,\n    strokeWidth: props.strokeWidth,\n    fill: props.fill,\n    name: props.name,\n    hide: props.hide,\n    tooltipType: props.tooltipType,\n    data: props.data,\n    trapezoids: trapezoids,\n    id: id\n  }), /*#__PURE__*/React.createElement(Layer, {\n    className: layerClass\n  }, /*#__PURE__*/React.createElement(RenderTrapezoids, _extends({}, everythingElse, {\n    id: id,\n    stroke: stroke,\n    fill: fill,\n    nameKey: nameKey,\n    lastShapeType: lastShapeType,\n    animationBegin: animationBegin,\n    animationDuration: animationDuration,\n    animationEasing: animationEasing,\n    isAnimationActive: isAnimationActive,\n    hide: hide,\n    legendType: legendType,\n    height: height,\n    width: width,\n    trapezoids: trapezoids\n  }))));\n}\nexport function computeFunnelTrapezoids(_ref5) {\n  var {\n    dataKey,\n    nameKey,\n    displayedData,\n    tooltipType,\n    lastShapeType,\n    reversed,\n    offset,\n    customWidth,\n    graphicalItemId\n  } = _ref5;\n  var {\n    realHeight,\n    realWidth,\n    offsetX,\n    offsetY\n  } = getRealWidthHeight(customWidth, offset);\n  var maxValue = Math.max.apply(null, displayedData.map(entry => getValueByDataKey(entry, dataKey, 0)));\n  var len = displayedData.length;\n  var rowHeight = realHeight / len;\n  var parentViewBox = {\n    x: offset.left,\n    y: offset.top,\n    width: offset.width,\n    height: offset.height\n  };\n  var trapezoids = displayedData.map((entry, i) => {\n    // @ts-expect-error getValueByDataKey does not validate the output type\n    var rawVal = getValueByDataKey(entry, dataKey, 0);\n    var name = String(getValueByDataKey(entry, nameKey, i));\n    var val = rawVal;\n    var nextVal;\n    if (i !== len - 1) {\n      nextVal = getValueByDataKey(displayedData[i + 1], dataKey, 0);\n      if (nextVal instanceof Array) {\n        [val, nextVal] = nextVal;\n      }\n    } else if (rawVal instanceof Array && rawVal.length === 2) {\n      [val, nextVal] = rawVal;\n    } else if (lastShapeType === 'rectangle') {\n      nextVal = val;\n    } else {\n      nextVal = 0;\n    }\n\n    // @ts-expect-error this is a problem if we have ranged values because `val` can be an array\n    var x = (maxValue - val) * realWidth / (2 * maxValue) + offsetX;\n    var y = rowHeight * i + offsetY;\n    // @ts-expect-error getValueByDataKey does not validate the output type\n    var upperWidth = val / maxValue * realWidth;\n    var lowerWidth = nextVal / maxValue * realWidth;\n    var tooltipPayload = [{\n      name,\n      value: val,\n      payload: entry,\n      dataKey,\n      type: tooltipType,\n      graphicalItemId\n    }];\n    var tooltipPosition = {\n      x: x + upperWidth / 2,\n      y: y + rowHeight / 2\n    };\n    var trapezoidViewBox = {\n      x,\n      y,\n      upperWidth,\n      lowerWidth,\n      width: Math.max(upperWidth, lowerWidth),\n      height: rowHeight\n    };\n    return _objectSpread(_objectSpread(_objectSpread({}, trapezoidViewBox), {}, {\n      name,\n      val,\n      tooltipPayload,\n      tooltipPosition\n    }, omit(entry, ['width'])), {}, {\n      payload: entry,\n      parentViewBox,\n      labelViewBox: trapezoidViewBox\n    });\n  });\n  if (reversed) {\n    trapezoids = trapezoids.map((entry, index) => {\n      var reversedViewBox = {\n        x: entry.x - (entry.lowerWidth - entry.upperWidth) / 2,\n        y: entry.y - index * rowHeight + (len - 1 - index) * rowHeight,\n        upperWidth: entry.lowerWidth,\n        lowerWidth: entry.upperWidth,\n        width: Math.max(entry.lowerWidth, entry.upperWidth),\n        height: rowHeight\n      };\n      return _objectSpread(_objectSpread(_objectSpread({}, entry), reversedViewBox), {}, {\n        tooltipPosition: _objectSpread(_objectSpread({}, entry.tooltipPosition), {}, {\n          y: entry.y - index * rowHeight + (len - 1 - index) * rowHeight + rowHeight / 2\n        }),\n        labelViewBox: reversedViewBox\n      });\n    });\n  }\n  return trapezoids;\n}\nexport function Funnel(outsideProps) {\n  var _resolveDefaultProps = resolveDefaultProps(outsideProps, defaultFunnelProps),\n    {\n      id: externalId\n    } = _resolveDefaultProps,\n    props = _objectWithoutProperties(_resolveDefaultProps, _excluded4);\n  return /*#__PURE__*/React.createElement(RegisterGraphicalItemId, {\n    id: externalId,\n    type: \"funnel\"\n  }, id => /*#__PURE__*/React.createElement(FunnelImpl, _extends({}, props, {\n    id: id\n  })));\n}\nFunnel.displayName = 'Funnel';","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}